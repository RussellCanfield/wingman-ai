# Agents & Sub-Agents

Agents live in `.wingman/agents/<agent-id>/` and can be defined as either JSON (`agent.json`) or Markdown (`agent.md` with frontmatter).

## Discovery vs routing

- **Discovery**: agent definitions are loaded from `.wingman/agents/<agent-id>/`.
- **Routing & metadata**: defaults, display names, workspaces, and channel bindings live in `wingman.config.json` under `agents.list` and `agents.bindings`.

If you want the gateway to route messages to a specific agent (or show a friendly name in the UI), add entries in `wingman.config.json`. See the `agents` section in the `wingman.config.json` guide.

## Bundled agents (starter templates)

Wingman ships with a small set of bundled agents so you can start quickly. These live in the package at:

```text
apps/wingman/.wingman/agents/
```

When you run `wingman init`, the templates are copied into your workspace:

```text
.wingman/agents/
```

You can choose a subset during setup:

```bash
wingman init --agents main,coding,stock-trader
```

To re-copy bundled agents later without changing config or provider settings:

```bash
wingman init --skip-config --skip-provider
wingman init --skip-config --skip-provider --agents main,coding
wingman init --skip-config --skip-provider --force
```

Typical bundled agents include:

- `main` (general-purpose)
- `coding` (direct-execution coding specialist with tool-backed completion guard)
- `coding-v2` (multi-subagent coding orchestrator with planner/implementor/reviewer split)
- `game-dev` (game feature orchestrator with specialist sub-agents, including UV/geometry-aware texture generation guidance)
- `researcher` (source-first web research)
- `stock-trader` (market data research workflows)
- `wingman` (workspace-specific assistant)

Edit these in-place to customize prompts, tools, or sub-agents. Treat them as templates—clone and rename as needed for each project.

:::warning
The `stock-trader` agent is for research and education only. It does not provide financial advice or execute trades.
:::

For readability, the `stock-trader` agent returns a concise Decision Packet with a direct answer first, followed by short sections that summarize the key signals and risks (no raw tool dumps). Ask it to expand any section if you need deeper detail.

## Provider credentials (env vars)

Agents that talk to model providers require credentials. Use either `wingman provider login <provider>` or environment variables, for example:

```text
OPENAI_API_KEY
ANTHROPIC_API_KEY
OPENROUTER_API_KEY
XAI_API_KEY
```

## agent.json example

```json
{
  "name": "wingman",
  "description": "General-purpose coding assistant for this repo.",
  "systemPrompt": "Be concise. Ask clarifying questions when needed.",
  "tools": ["code_search", "git_status", "command_execute", "internet_search"],
  "model": "anthropic:claude-sonnet-4-5",
  "promptRefinement": {
    "enabled": true,
    "instructionsPath": "/memories/agents/wingman/instructions.md"
  },
  "blockedCommands": ["rm", "mv"],
  "allowScriptExecution": true,
  "commandTimeout": 300000,
  "mcpUseGlobal": true,
  "voice": {
    "provider": "elevenlabs",
    "elevenlabs": { "voiceId": "voice_123" }
  },
  "subAgents": [
    {
      "name": "reviewer",
      "description": "Reviews code changes for risk.",
      "systemPrompt": "Check for regressions and missing tests.",
      "model": "openai:gpt-4o"
    }
  ]
}
```

## agent.md example

```md
---
name: researcher
description: Gathers context and produces concise briefs.
model: openrouter:openai/gpt-4o
promptRefinement:
  enabled: true
  instructionsPath: /memories/agents/researcher/instructions.md
tools:
  - internet_search
  - web_crawler
  - think
---
You are a researcher. Summarize sources and provide citations.
```

## Sub-agent model overrides

Sub-agents can override **any** agent field, including model, tools, voice, and command controls. This lets you mix fast/cheap models with deep/reasoning models in one squad.

```json
{
  "name": "wingman",
  "description": "Lead agent that delegates.",
  "systemPrompt": "Delegate to specialists when possible.",
  "subAgents": [
    {
      "name": "planner",
      "description": "Breaks tasks into steps.",
      "systemPrompt": "Produce a short plan before implementation.",
      "model": "openai:gpt-4o"
    },
    {
      "name": "reviewer",
      "description": "Finds regressions and missing tests.",
      "systemPrompt": "Review diffs for correctness.",
      "model": "anthropic:claude-sonnet-4-5"
    }
  ]
}
```

## Sub-agent prompt files (agent.md)

When using `agent.md`, sub-agents can load their prompts from separate files with `promptFile`. This keeps large prompts readable and makes it easier to reuse or iterate on specialist instructions.

```md
---
name: wingman
description: Lead agent with specialist sub-agents.
subAgents:
  - name: planner
    description: Produces concise plans.
    model: openai:gpt-4o
    promptFile: planner.md
  - name: reviewer
    description: Reviews code for risk.
    model: anthropic:claude-sonnet-4-5
    promptFile: reviewer.md
---
You are the lead agent. Delegate to specialists as needed.
```

File layout:

```text
.wingman/agents/wingman/
  agent.md
  planner.md
  reviewer.md
```

If a prompt file contains frontmatter, those fields **override/extend** the sub-agent metadata. Otherwise the file is treated as the sub-agent’s `systemPrompt`.

## Available tools

Agents can only use the tools listed in the `tools` array. Available tool names:

- `internet_search`
- `web_crawler`
- `command_execute`
- `background_terminal`
- `think`
- `code_search`
- `git_status`
- `ui_registry_list`
- `ui_registry_get`
- `ui_present`

## Sub-agent delegation

`subAgents` lets you define specialist agents. The parent agent can delegate tasks when needed. Each sub-agent supports the same schema fields as a normal agent.

## Prompt refinement

`promptRefinement` enables a per-agent instruction overlay that the agent can update over time based on explicit feedback.

- The overlay is stored under `/memories/` so it persists across sessions.
- Updates only happen when users give clear, durable preferences (e.g., “always do X”, “never do Y”).
- Keep the file short and stable: preferences, workflow rules, and corrections.

## MCP and voice overrides

- `mcp`: agent-specific MCP servers
- `mcpUseGlobal`: include global MCP servers from `wingman.config.json`
- `voice`: overrides global voice configuration for this agent
- `promptRefinement`: enable/disable prompt refinement and set the overlay path

## Why voice is duplicated in agent config

Voice exists in both **global** config and **agent** config so you can set defaults once and override per agent. This allows one agent to speak with ElevenLabs while another uses Web Speech (or stays silent).

```json
// wingman.config.json
{
  "voice": {
    "provider": "web_speech",
    "defaultPolicy": "manual",
    "webSpeech": { "lang": "en-US" }
  }
}
```

```json
// agent.json
{
  "name": "narrator",
  "description": "Reads summaries aloud.",
  "systemPrompt": "Narrate results.",
  "voice": {
    "provider": "elevenlabs",
    "elevenlabs": { "voiceId": "voice_123" }
  }
}
```
